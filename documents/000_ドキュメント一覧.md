(ここでは **コード化しづらい／合意と運用を固定する設計書**を中心にしています。規約やスキーマはコード側で担保する前提でも、設計書として残す価値が高いものです。)

(コードの内容を正として、ドキュメントは補足資料として位置づけます。コードとドキュメントに矛盾がある場合はコードを正とします。)

---

## 必要な設計書一覧（表）

| No | 設計書名                                        | 目的（何を固定するか）          | 主な記載内容（要点）                                         | 更新頻度   | 必須度    |
| -: | ------------------------------------------- | -------------------- | -------------------------------------------------- | ------ | ------ |
|  1 | **要件定義書**                                   | 何を作る/作らない、優先順位、成功条件  | 目的、ユースケース、スコープ/非スコープ、制約（EOD/CLI/UIなし等）、前提、KPI/DoD  | 低      | **必須** |
|  2 | **外部設計書**                                   | 利用者視点の振る舞いと外部I/F     | 入出力（Decision Packの意味）、EOD運用フロー、保証事項、免責、縮退方針の概要     | 中      | **必須** |
|  3 | **内部設計書（アーキテクチャ設計）**                        | レイヤ構造・責務・依存方向        | src構成、主要モジュール責務、依存禁止ルール、拡張ポイント（M1→M9）              | 中      | **必須** |
|  4 | **パイプライン設計書（EOD Pipeline Spec）**            | Step順序と責務境界（実装ぶれ防止）  | Step一覧、入出力、エラー時の扱い（スキップ/停止）、再実行性、実行コンテキスト          | 中      | **必須** |
|  5 | **データ設計書（Data Contract / Data Quality）**    | データ前提と品質ルール          | asof定義、TZ、yfinance取得範囲、欠損許容、企業アクション方針、キャッシュ方針      | 中      | **必須** |
|  6 | **フェイルセーフ設計書（Failure & Fallback）**          | 障害時の振る舞いと安全側縮退       | 銘柄スキップ条件、市場停止条件、LLM/ML不調時、warnings付与方針、通知/復旧       | 中      | **必須** |
|  7 | **運用設計書（Runbook/Operations）**               | 日次/週次/月次の運用手順        | EOD実行手順、確認チェック、再実行、ログ確認、障害対応、定期レビュー                | 中      | 推奨     |
|  8 | **変更管理設計書（Change Control / Compatibility）** | 互換性とリリース運用           | 破壊的変更の定義、SemVer、catalog_version、移行手順、更新義務（設計書/ADR） | 中      | **必須** |
|  9 | **評価設計書（Acceptance Criteria / DoD）**        | 完成判定の客観化             | M1/M2…の受入条件、必須テスト、再現性基準、品質ゲート、許容逸脱                 | 中      | **必須** |
| 10 | **セキュリティ設計書（Security & Compliance）**        | 取り扱い制約と責任範囲          | 秘密情報管理、免責表現、ログのマスキング、権限、依存リスク、監査方針                 | 低      | 推奨     |
| 11 | **用語集（Glossary）**                           | 言葉の意味の固定（レビューとLLM安定） | plan/strategy、EV、uncertainty、regimeなどの定義、単位、表記揺れ   | 中      | **必須** |
| 12 | **ADR集（Architecture Decision Records）**     | 「なぜそうしたか」を固定         | LLM制約、feature分離、決定論、縮退方針、依存方向などの意思決定と理由            | 高（小刻み） | **必須** |

---

### 最小セット

自動実装の“ぶれ止め”として最低限は以下です。

* 要件定義書（No.1）
* 外部設計書（No.2）
* 内部設計書（No.3）
* パイプライン設計書（No.4）
* データ設計書（No.5）
* フェイルセーフ設計書（No.6）
* 変更管理設計書（No.8）
* 評価設計書（No.9）
* 用語集（No.11）
* ADR集（No.12）