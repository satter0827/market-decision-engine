# 用語集（Glossary）

## market-decision-engine

---

## A. 基本概念・全体構造

### EOD（End of Day）

各市場において **当日の取引が終了し、終値が確定した状態**。
本システムでは、すべての判断・計算は EOD を基準に行われる。

---

### Pipeline（パイプライン）

EOD 実行時に **一方向に順序通り実行される処理の集合**。
循環・自己更新を持たず、同一入力に対して同一出力を返すことを原則とする。

---

### Run（実行）

`market + asof + policy_snapshot` を単位とした **1回のEOD処理**。
再現性・監査の最小単位。

---

### Run Context

Run 全体で共有される実行文脈情報。
`run_id / market / asof / policy_snapshot_id / universe_id` 等を含む。

---

### Market（市場）

対象とする取引市場の区分。
初期は `JP`（日本株）および `US`（米国株）のみを扱う。

---

## B. 方針・契約関連

### UserPolicy

ユーザーの運用方針を構造化した入力。
**閾値・制約・判断ルール**を含み、日次で頻繁に変えない前提とする。

---

### Policy Snapshot

特定の UserPolicy を **固定化・識別可能にしたもの**。
同一 snapshot を用いる限り、同一入力条件として扱われる。

---

### Contract（契約）

モジュール間・外部との間で合意された **データ構造・責務・意味**の総称。
Pydantic スキーマは契約の一部だが、意味・制約は文書で補完する。

---

## C. データ・特徴量

### Market Data（市場データ）

指数や市場全体を表すデータ。
主に **相場環境（regime）判定や保守化判断**に用いられる。

---

### Ticker Data（銘柄データ）

個別銘柄の日足 OHLCV データ。
**候補抽出・実行値生成の主根拠**。

---

### Feature（特徴量）

価格データ等から計算された数値指標。
本システムでは用途別に明確に分離する。

---

### daily feature

日足価格系列から直接導出される特徴量。
**候補抽出・Entry/Stop/Target 計算の唯一の根拠**。

---

### static feature

銘柄に比較的安定して紐づく特徴量（流動性、規模等）。
**サイズ・可否の補正**にのみ使用し、価格決定には使わない。

---

### fundamental feature

財務・企業情報に基づく特徴量。
ML 評価において **段階導入**される補助情報。

---

### lookback

特徴量計算に必要な **過去データの最小期間**。
不足する銘柄は原則スキップ対象。

---

## D. 相場・候補・戦略

### Regime（相場環境）

市場全体の状態（例：risk-on / risk-off）。
価格計算には直接混ぜず、**候補数・サイズの保守化**に影響させる。

---

### Candidate（候補銘柄）

daily feature の条件を満たし、
**Execution を試行する対象として選ばれた銘柄**。

---

### Candidate Selection（候補抽出）

daily feature のみを根拠として候補銘柄を選ぶ工程。
static / fundamental を混ぜないことが設計上の重要原則。

---

### Plan（戦略プラン）

Execution を行うための **引数セット（plan_args）**。
コードではなく **カタログ管理**を基本とする。

---

### Plan Catalog

利用可能な Plan の集合を定義した構成情報。
戦略追加時のコード変更を最小化する目的で存在する。

---

## E. Execution・リスク・評価

### Execution

候補銘柄に対して **発注可能な具体値**を生成する処理。
Entry / Stop / Target / Size / TimeStop を含む。

---

### Entry

想定する新規建て価格。

---

### Stop

最大損失を限定するための価格水準。

---

### Target

利確目標価格。
R 倍数（例：2R、3R）として扱われることが多い。

---

### Time Stop

価格に関係なく、一定日数経過でクローズする条件。

---

### Risk / Sizing（リスク・サイズ補正）

価格を変えずに、**ポジションサイズや可否のみを調整**する工程。
常に安全側（縮小方向）に倒す。

---

### ML Evaluation

機械学習による **成功確率・期待値・不確実性**の推定。
必須ではなく、常に縮退可能である必要がある。

---

### Uncertainty（不確実性）

推定結果の信頼度の低さを示す尺度。
高い場合は判断を保守化する方向に作用する。

---

## F. 判断・出力

### Decision

Execution・Risk・評価を統合した **最終的な意思決定**。

---

### DecisionCore

機械可読な最終判断。
**そのまま発注可能な数値と判定**を含む、最重要成果物。

---

### Buy Signal

売買判断の結果。
本システムでは以下の **3値固定**とする。

* `YES`：通常サイズで実行可能
* `YES_HALF`：条件付き・縮小サイズでのみ実行可能
* `NO`：実行しない

---

### Rank

同一 Run 内での **相対的な優先順位**。
発注可能性・期待値・不確実性を総合した結果。

---

### Decision Pack

1銘柄分の最終成果物。
DecisionCore と ShortSummary を含む。

---

### ShortSummary

人間向けの短文説明。
LLM により生成されるが、**判断基準や数値を増やさない**。

---

## G. LLM・縮退

### LLM（Large Language Model）

自然言語生成モデル。
本システムでは **翻訳・要約・監査専用**。

---

### LLM Layer

DecisionCore を変更せず、
ShortSummary を生成・整形・検査する層。

---

### Degraded（縮退）

品質や情報量を落としてでも **安全に継続する状態**。
YES を弱める、サイズを減らす、説明を省略する等。

---

### Fail-safe（フェイルセーフ）

異常・不確実性が発生した際に
**誤ったYESを出さないための設計思想と仕組み**。

---

### Skip（スキップ）

銘柄単位で処理対象外とすること。
市場全体は継続する。

---

### Fatal

市場バッチ全体を停止すべき致命的状態。
主に入力契約違反が該当する。

---

## H. 運用・監査

### Reproducibility（再現性）

同一入力条件に対して同一出力が得られる性質。
本システムの最優先品質特性の一つ。

---

### Auditability（監査可能性）

「なぜこの判断になったか」を
後から追跡・説明できる性質。

---

### Warning

判断自体は成立しているが、
**注意すべき条件・品質低下**を示す付帯情報。

---

## まとめ（用語集の位置づけ）

* 本用語集は **設計・実装・レビュー時の共通言語**である
* コードに書けることではなく、**意味のズレを防ぐこと**が目的
* 新機能追加時は、まず用語の追加・定義変更を検討する
